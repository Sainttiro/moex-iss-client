# Описание Состояния Проекта

Этот документ описывает текущее состояние проекта `moex-iss-client` на момент последнего коммита. Он предназначен для быстрого введения в курс дела новых разработчиков и ИИ-ассистентов.

## Обзор проекта

`moex-iss-client` — это Python-клиент для взаимодействия с API Информационно-статистического сервера (ИСС) Московской Биржи.

### Основные возможности:
- Аутентификация с использованием логина и пароля.
- Загрузка исторических данных по ценным бумагам.
- Сохранение данных в формате JSON.
- Удобный интерфейс командной строки (CLI).

## Технологический стек

- **Язык:** Python 3.8+
- **HTTP-клиент:** `requests`
- **CLI-фреймворк:** `click`
- **Конфигурация:** `pydantic` и `python-dotenv`
- **Форматирование вывода:** `rich`
- **Сборка и управление зависимостями:** `pyproject.toml` (setuptools)

## Архитектура

Проект имеет модульную структуру:

- `src/moex_client/client/api.py`: Основной класс `MoexClient`, отвечающий за запросы к API и обработку данных.
- `src/moex_client/auth/api.py`: Класс `MoexAuth` для аутентификации и получения сессионных cookie.
- `src/moex_client/config/settings.py`: Управление конфигурацией через переменные окружения с помощью `pydantic`.
- `src/moex_client/cli/main.py`: Реализация CLI с помощью `click`. Основная команда — `history` для загрузки данных.

## Реализованная функциональность

Была добавлена возможность прямой загрузки исторических данных в ClickHouse.

### Ключевые изменения:
1.  **Docker-окружение:** Добавлен `docker-compose.yml` для легкого запуска ClickHouse и Grafana (в качестве UI).
2.  **Расширение конфигурации:** В `settings.py` добавлены параметры для подключения к ClickHouse.
3.  **Модуль для ClickHouse:** Создан `src/moex_client/clickhouse.py`, который инкапсулирует логику взаимодействия с базой данных (создание таблицы, вставка данных).
4.  **Обновление CLI:** В команду `history` добавлен флаг `--to-clickhouse`, который активирует прямую загрузку данных в ClickHouse. Также восстановлена возможность загрузки данных за одну конкретную дату (`--date`) и улучшена логика парсинга дат.
5.  **Обработка типов данных:** В `src/moex_client/cli/main.py` добавлена логика для корректного преобразования строковых значений числовых полей в `float` перед вставкой в ClickHouse, а также обработка `None` и пустых строк.
6.  **Улучшение `.gitignore`:** Добавлена директива для игнорирования временных файлов `clickhouse_data/`.
